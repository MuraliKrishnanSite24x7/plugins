# Plugin for Apache Monitoring

The Apache HTTP Server, commonly known as Apache, is the world's most used web server software. Configure Site24x7 Apache plugin to monitor the performance of your apache server and stay on top of issues at all times.

## Prerequisites

Download and install the latest version of the [Site24x7 Linux agent](https://www.site24x7.com/app/client#/admin/inventory/add-monitor) in the server where you plan to run the plugin.

#### Perform the following configuration in Apache configuration file to get the performance metrics - 
1. Enable mod_status

- Apache configuration file is located at one of the following locations, depending on your Linux distribution.
	```
	    /etc/apache2/httpd.conf
	    /etc/apache2/apache2.conf
	    /etc/httpd/httpd.conf
	    /etc/httpd/conf/httpd.conf
	```

- Open terminal and run the following command to open Apache configuration file "/etc/httpd/conf/httpd.conf".

  	``` 	$ sudo vi /etc/httpd/conf/httpd.conf 	```

- In the file "/etc/httpd/conf/httpd.conf", search for the following line

	``` 	#LoadModule status_module modules/mod_status.so 	```

- Uncomment the above line by removing # at its beginning.

	``` 	LoadModule status_module modules/mod_status.so 		```



2. Configure mod_status in Apache configuration "/etc/httpd/conf/httpd.conf" file

- Search for the following block of code 
	```
		# Allow server status reports generated by mod_status,
		# with the URL of http://servername/server-status
		# Change the ".example.com" to match your domain to enable.
		#
		#<location server-status="">
		#    SetHandler server-status
		#    Order deny,allow
		#    Deny from all
		#    Allow from .example.com
		#</location>
	```

- Uncomment the location block by removing # in front of its lines, and update the Allow, Order and Deny directives as shown below.
	```
		<Location /server-status>
		   SetHandler server-status
		   Order allow,deny
		   Deny from all
		   Allow from all
		</Location>
	```

The above configuration works for default Apache configuration. If you want to change the URL at which the dashboard is available, then change /server-status in location tag as per your requirement.


Also, this configuration will not work for Virtual Hosts. If you have configurated Virtual Hosts, then you need to place this location block inside the VirtualHost block, as shown below.

	
		     <VirtualHost *:80>
			   …
			   <Location /server-status>
			      SetHandler server-status
			      Order allow,deny
			      Deny from all
			      Allow from example.com
			   </Location>
			  …
		     </VirtualHost>

3. After completing all the changes restart the apache server using the below linux command.
	```
	service apache restart
	```
	

## Plugin Installation  

- Once installed the respective agent in the server, create a directory named "apache_monitoring".
      
- Download all the files in the "apache_monitoring" folder and place it under the "apache_monitoring" directory.

		wget https://github.com/site24x7/plugins/raw/master/apache_monitoring/apache_monitoring.py
		wget https://github.com/site24x7/plugins/raw/master/apache_monitoring/apache_monitoring.cfg

- Execute the below command with appropriate arguments to check for the valid json output:

	 ```bash
	 python3 apache_monitoring.py --url=<apache stats url> --username=<apache username> --password=<apache password> 
	 ```

- Once the above command execution given the valid json, further provide the command argument as configurations in apache_monitoring.cfg file.
	```
		[localhost]
		url = "http://localhost:80/server-status?auto"
		username = None
		password = None
		timeout = 30
		plugin_version = "1"
		heartbeat = "true"
		logs_enabled = "true"
		log_type_name = "Apache Access Logs"
		log_file_path = "/var/log/apache*/access.log*"
	```	
- In case, if user configured virtualHost and to monitor multiple domains status using same plugin. Please follow the below link to configure those domains to monitor
	 https://www.site24x7.com/help/admin/adding-a-monitor/plugins/custom-plugins.html#multiple-config

- Once the configuration done, move the "apache_monitoring" directory under the Site24x7 Linux Agent plugin directory: 

		 	Linux             ->   /opt/site24x7/monagent/plugins/apache_monitoring 	

		
The agent will automatically execute the plugin within five minutes and user can see the plugin monitor under Site24x7 > Plugins > Plugin Integrations.


In case if user needs to run this apache_monitoring plugin in windows server, please follow the steps in below link.
https://support.site24x7.com/portal/en/kb/articles/run-python-plugin-scripts-in-windows-servers



## Performance Metrics

- **Requests per Second**
req_per_sec records the total number of HTTP requests the web server is processing per second.
- **Busy Workers**
Use the metric busy_workers to get the total number of processes actively processing an HTTP request.
- **Idle Workers**
idle_workers is the total number of idle workers/idle processes waiting for an HTTP request.
- **Bytes per Second**
bytes_per_sec records the total amount of data the web server is transferring per second.
- **Bytes per Request**
The average number of bytes being transferred per HTTP request is obtained using the metric bytes_per_req.
- **Processes**
Processes denotes the number of async processes.
- **Connections Async Closing**
Connections Async Closing shows the number of async connections that are in the closing state.
- **Connections Async Keep Alive**
Connections Async Keep Alive displays the number of async connections that are in the keep-alive state.
- **Connections Async Writing**
Connections Async Writing denotes the number of async connections that are in the writing state.
- **CPU Load**
Use the metric cpu_load and get the total percentage of CPU used by the web server.
- **CPU System**
CPU System shows the percentage of time taken by the Apache process to access the system resources.
- **CPU User**
CPU User displays the percentage of time taken by the Apache process to process the code.
- **Load1**
Load1 shows the one-minute load average.
- **Load5**
Load5 denotes the five-minute load average.
- **Load15**
Load15 displays the 15-minute load average.
- **Total Accesses**
The total number of accesses on the server is monitored using the metric total_accessess.
- **Total Connections**
Total Connections depicts the total number of connections on the Apache server.
- **Total kbytes**
Total kbytes records the total kilobytes served.
- **Uptime**
Uptime shows the total amount of time the server has been up and running.
- **Version**
Version denotes the Apache server version.


